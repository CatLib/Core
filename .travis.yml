language: csharp
mono: none
dotnet: 2.1.502

stages:
  - compile
  - test

jobs:
  include:
    - stage: compile
      script:
        - dotnet build -c Release
    - stage: test
      before_build:
        - choco install codecov
      script:
        - dotnet test --no-build -c Release -s ../settings.runsettings /p:CollectCoverage=true /p:CoverletOutputFormat=\"json,teamcity,opencover\" /p:CoverletOutput=\"../../coverage/\" /p:Exclude=[*.Tests]* /p:Threshold=90 /p:ThresholdType=line
      after_success:
        - codecov -f coverage/coverage.opencover.xml -t $CODE_COV_TOKEN